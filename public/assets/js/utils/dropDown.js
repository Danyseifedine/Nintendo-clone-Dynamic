export default class DropdownManager{static backdrop=null;static activeDropdown=null;constructor(options){if(typeof options.triggerSelector==='string'){this.triggers=document.querySelectorAll(options.triggerSelector)}else if(options.triggerSelector instanceof NodeList){this.triggers=options.triggerSelector}else{this.triggers=[options.triggerSelector]}
this.dropdown=typeof options.dropdownSelector==='string'?document.querySelector(options.dropdownSelector):options.dropdownSelector;this.animationDuration=options.animationDuration||300;this.onShow=options.onShow||(()=>{});this.onHide=options.onHide||(()=>{});this.closeOnOutsideClick=options.closeOnOutsideClick!==!1;this.positionRelativeToHeader=options.positionRelativeToHeader||!1;this.headerSelector=options.headerSelector||'header';this.useBackdrop=options.useBackdrop||!1;this.height=options.height||null;this.hideHeader=options.hideHeader||!1;this.header=document.querySelector(this.headerSelector);if(this.useBackdrop&&!DropdownManager.backdrop){DropdownManager.createSharedBackdrop()}
this.toggle=this.toggle.bind(this);this.show=this.show.bind(this);this.hide=this.hide.bind(this);this.handleOutsideClick=this.handleOutsideClick.bind(this);this.positionDropdown=this.positionDropdown.bind(this);this.init()}
returnTrigger(){return this.triggers}
init(){if(this.triggers.length===0||!this.dropdown){console.error('Dropdown trigger(s) or content element not found');return}
if(!this.dropdown.classList.contains('hidden')){this.dropdown.classList.add('hidden')}
this.addCloseButton();this.triggers.forEach(trigger=>{trigger.addEventListener('click',(e)=>{e.preventDefault();this.toggle()})});if(this.closeOnOutsideClick){document.addEventListener('click',this.handleOutsideClick)}
if(this.positionRelativeToHeader){window.addEventListener('resize',this.positionDropdown)}
if(this.height&&!this.hideHeader){this.dropdown.style.height=`${this.height}px`;this.dropdown.style.overflowY='auto'}
if(this.hideHeader){this.dropdown.classList.add('fullscreen-dropdown')}}
addCloseButton(){const closeButton=document.createElement('button');closeButton.className='dropdown-close-btn close-mobile-search-panel';closeButton.innerHTML='Ã—';closeButton.addEventListener('mouseenter',()=>{closeButton.style.backgroundColor='#484848'});closeButton.addEventListener('mouseleave',()=>{closeButton.style.backgroundColor=' rgb(205, 205, 205';closeButton.style.color='white'});closeButton.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();this.hide()});if(getComputedStyle(this.dropdown).position==='static'){this.dropdown.style.position='relative'}
this.dropdown.appendChild(closeButton)}
static createSharedBackdrop(){if(!DropdownManager.backdrop){DropdownManager.backdrop=document.createElement('div');DropdownManager.backdrop.className='dropdown-backdrop lg:block hidden';DropdownManager.backdrop.style.position='fixed';const header=document.querySelector('header');const headerHeight=header?header.offsetHeight:0;DropdownManager.backdrop.style.top=headerHeight+'px';DropdownManager.backdrop.style.left='0';DropdownManager.backdrop.style.width='100%';DropdownManager.backdrop.style.height=`calc(100% - ${headerHeight}px)`;DropdownManager.backdrop.style.backgroundColor='rgba(0, 0, 0, 0.5)';DropdownManager.backdrop.style.zIndex='40';DropdownManager.backdrop.style.opacity='0';DropdownManager.backdrop.style.visibility='hidden';DropdownManager.backdrop.style.transition='opacity 0.3s ease, visibility 0.3s ease';document.body.appendChild(DropdownManager.backdrop);DropdownManager.backdrop.addEventListener('click',()=>{if(DropdownManager.activeDropdown){DropdownManager.activeDropdown.hide()}});window.addEventListener('resize',()=>{if(DropdownManager.activeDropdown&&!DropdownManager.activeDropdown.hideHeader){const header=document.querySelector('header');const headerHeight=header?header.offsetHeight:0;DropdownManager.backdrop.style.top=headerHeight+'px';DropdownManager.backdrop.style.height=`calc(100% - ${headerHeight}px)`}})}}
toggle(){if(window.innerWidth<1024){return}
if(this.dropdown.classList.contains('hidden')){this.show()}else{this.hide()}}
show(){if(window.innerWidth<1024){return}
if(DropdownManager.activeDropdown&&DropdownManager.activeDropdown!==this){const previousDropdown=DropdownManager.activeDropdown;DropdownManager.activeDropdown=null;previousDropdown.dropdown.classList.remove('show');previousDropdown.dropdown.classList.add('hidden');previousDropdown.dropdown.style.opacity='0';previousDropdown.dropdown.style.visibility='hidden';previousDropdown.dropdown.style.pointerEvents='none';previousDropdown.triggers.forEach(trigger=>{trigger.classList.remove('active')});if(previousDropdown.hideHeader&&this.useBackdrop&&DropdownManager.backdrop){const headerHeight=this.header?this.header.offsetHeight:0;DropdownManager.backdrop.style.top=headerHeight+'px';DropdownManager.backdrop.style.height=`calc(100% - ${headerHeight}px)`;DropdownManager.backdrop.style.zIndex='40'}
if(previousDropdown._hideTimeout){clearTimeout(previousDropdown._hideTimeout)}
if(previousDropdown.hideHeader){document.body.classList.remove('overflow-hidden')}}
DropdownManager.activeDropdown=this;this.triggers.forEach(trigger=>{trigger.classList.add('active')});this.dropdown.style.opacity='';this.dropdown.style.visibility='';this.dropdown.style.pointerEvents='';if(this.hideHeader){this.dropdown.style.top='0';this.dropdown.style.left='0';this.dropdown.style.width='100%';this.dropdown.style.height='100vh';this.dropdown.style.position='fixed';this.dropdown.style.zIndex='200';this.dropdown.style.overflowY='auto';if(this.useBackdrop&&DropdownManager.backdrop){DropdownManager.backdrop.style.top='0';DropdownManager.backdrop.style.height='100%';DropdownManager.backdrop.style.zIndex='150'}
document.body.classList.add('overflow-hidden')}else{if(this.positionRelativeToHeader){this.positionDropdown()}
if(this.useBackdrop&&DropdownManager.backdrop){const headerHeight=this.header?this.header.offsetHeight:0;DropdownManager.backdrop.style.top=headerHeight+'px';DropdownManager.backdrop.style.height=`calc(100% - ${headerHeight}px)`;DropdownManager.backdrop.style.zIndex='40'}}
if(this.useBackdrop&&DropdownManager.backdrop){DropdownManager.backdrop.style.opacity='1';DropdownManager.backdrop.style.visibility='visible'}
this.dropdown.classList.remove('hidden');setTimeout(()=>{this.dropdown.classList.add('show');this.onShow()},10)}
hide(){this.triggers.forEach(trigger=>{trigger.classList.remove('active')});if(DropdownManager.activeDropdown===this){DropdownManager.activeDropdown=null;if(this.useBackdrop&&DropdownManager.backdrop){DropdownManager.backdrop.style.opacity='0';DropdownManager.backdrop.style.visibility='hidden';if(this.hideHeader){const header=document.querySelector('header');const headerHeight=header?header.offsetHeight:0;DropdownManager.backdrop.style.top=headerHeight+'px';DropdownManager.backdrop.style.height=`calc(100% - ${headerHeight}px)`;DropdownManager.backdrop.style.zIndex='40'}}
if(this.hideHeader){document.body.classList.remove('overflow-hidden')}}
this.dropdown.classList.remove('show');this._hideTimeout=setTimeout(()=>{this.dropdown.classList.add('hidden');this.dropdown.style.opacity='0';this.dropdown.style.visibility='hidden';this.dropdown.style.pointerEvents='none';this.onHide()},this.animationDuration)}
handleOutsideClick(e){const isOutsideTriggers=Array.from(this.triggers).every(trigger=>!trigger.contains(e.target));const isOutsideDropdown=!this.dropdown.contains(e.target);if(isOutsideTriggers&&isOutsideDropdown){this.hide()}}
positionDropdown(){if(!this.hideHeader&&this.header){const navHeight=this.header.offsetHeight;this.dropdown.style.top=navHeight+'px';this.dropdown.style.position='fixed';this.dropdown.style.left='0';this.dropdown.style.width='100%'}}
destroy(){this.triggers.forEach(trigger=>{trigger.removeEventListener('click',this.toggle)});document.removeEventListener('click',this.handleOutsideClick);window.removeEventListener('resize',this.positionDropdown);if(this.useBackdrop&&DropdownManager.backdrop){DropdownManager.backdrop.remove()}}}